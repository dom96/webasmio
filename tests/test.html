<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Webasmio</title>

    <!-- Depend on WABT for now to convert WAST to WASM. -->
    <script src="https://unpkg.com/wabt@v1.0.15/index.js"></script>

    <script>
        // Create a module from a WebAssembly Text format: https://stackoverflow.com/a/60921153/492186
        var myModule = WabtModule().parseWat("file.wat", `(module
            (func $add (param $lhs i32) (param $rhs i32) (result i32)
                local.get $lhs
                local.get $rhs
                i32.add)
            (export "add" (func $add))
        )`, {});

        // Emit module in a binary format
        var wasmData = myModule.toBinary({}).buffer;

        // Use WebAssembly API to instantiate a compiled module
        var compiled = new WebAssembly.Module(wasmData);
        var instance = new WebAssembly.Instance(compiled, {});

        // And use it
        console.log(instance.exports.add(41, 1));

    </script>
  </head>
  <body style="margin: 0; overflow: hidden;">

  </body>
</html>
